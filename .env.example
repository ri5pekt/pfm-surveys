# ==============================================
# SURVEY PLATFORM - ENVIRONMENT CONFIGURATION
# ==============================================
# Copy this file to .env and customize for your environment
# IMPORTANT: Never commit .env to version control

# ----------------------------------------------
# DEVELOPMENT SETUP:
# - PostgreSQL and Redis run in Docker containers
# - API, Worker, and Admin run locally (Node.js/Vite processes)
# - Use localhost for DATABASE_HOST and REDIS_HOST
#
# PRODUCTION SETUP:
# - All services run in Docker containers
# - Use service names (postgres, redis) for hosts
# ----------------------------------------------

# ----------------------------------------------
# Database Configuration
# ----------------------------------------------
# For dev (local processes): Use localhost
# For prod (Docker): Use "postgres"
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_NAME=surveys_dev
DATABASE_USER=surveys_user
DATABASE_PASSWORD=change_this_password

# Connection pool settings
DATABASE_POOL_MIN=2
DATABASE_POOL_MAX=10

# ----------------------------------------------
# Redis Configuration
# ----------------------------------------------
# For dev (local processes): Use localhost
# For prod (Docker): Use "redis"
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# ----------------------------------------------
# API Server Configuration
# ----------------------------------------------
API_PORT=3000
API_HOST=0.0.0.0
NODE_ENV=development

# CORS Settings (comma-separated origins)
CORS_ORIGINS=http://localhost:5173,http://localhost:3000

# Request body limits
BODY_LIMIT=1048576

# API rate limiting
RATE_LIMIT_MAX=100
RATE_LIMIT_WINDOW_MS=60000

# ----------------------------------------------
# Authentication & Security
# ----------------------------------------------
# JWT Secrets (CHANGE THESE IN PRODUCTION!)
# Generate with: node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
JWT_ACCESS_SECRET=your_jwt_access_secret_min_32_chars_change_this_in_production
JWT_REFRESH_SECRET=your_jwt_refresh_secret_min_32_chars_change_this_in_production

# JWT expiration times
JWT_ACCESS_EXPIRES_IN=15m
JWT_REFRESH_EXPIRES_IN=7d

# HMAC secret for embed script request signing
# Generate with: node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
HMAC_SECRET=your_hmac_secret_for_embed_signing_change_this_in_production

# HMAC validation settings
HMAC_TIMESTAMP_WINDOW_MS=300000
HMAC_NONCE_TTL_SECONDS=600

# ----------------------------------------------
# Email Configuration (SMTP - e.g. Hostinger)
# ----------------------------------------------
# Hostinger: smtp.hostinger.com, port 465 (SSL)
# Use surveys@pfm-qa.com mailbox credentials
SMTP_HOST=smtp.hostinger.com
SMTP_PORT=465
SMTP_USER=surveys@pfm-qa.com
SMTP_PASS=your_email_password_here
EMAIL_FROM_NAME=PFM Surveys

# ----------------------------------------------
# Geo / IP API (ip-api.com Pro)
# ----------------------------------------------
# Used by the worker to resolve country/state/city from IP for survey responses.
# Get a key at https://members.ip-api.com/ (Pro plan for production).
# Same key for dev and prod.
IP_API_KEY=

# ----------------------------------------------
# Background Worker Configuration
# ----------------------------------------------
WORKER_CONCURRENCY=5

# Rollup job interval (milliseconds)
ROLLUP_INTERVAL_MS=60000

# Event batch size for rollup processing
ROLLUP_BATCH_SIZE=1000

# ----------------------------------------------
# Admin Dashboard (Frontend)
# ----------------------------------------------
# Base URL for API calls from admin dashboard
# For dev: Local API on localhost:3000
# For prod: Use your production domain
VITE_API_BASE_URL=http://localhost:3000

# Admin app port (used by Vite dev server - dev only)
# In production, static files are served by Caddy/nginx
VITE_PORT=5173

# ----------------------------------------------
# Embed Script Configuration
# ----------------------------------------------
# API endpoint for embed widget
VITE_EMBED_API_URL=http://localhost:3000

# Embed script version (for cache busting)
VITE_EMBED_VERSION=1.0.0

# Event buffer settings
VITE_EMBED_BUFFER_SIZE=10
VITE_EMBED_FLUSH_INTERVAL_MS=5000

# ----------------------------------------------
# Logging Configuration
# ----------------------------------------------
LOG_LEVEL=debug
LOG_PRETTY_PRINT=true

# ----------------------------------------------
# Optional: Monitoring & Observability
# ----------------------------------------------
# SENTRY_DSN=
# PROMETHEUS_ENABLED=false
# PROMETHEUS_PORT=9090

# ----------------------------------------------
# Production-Only Settings
# ----------------------------------------------
# Uncomment for production deployments

# FORCE_HTTPS=true
# TRUST_PROXY=true
# SESSION_SECURE=true

# Domain for production deployment
# DOMAIN=surveys.yourdomain.com

# ----------------------------------------------
# Docker Compose Overrides
# ----------------------------------------------
# These override Docker Compose service settings when using docker-compose up

COMPOSE_PROJECT_NAME=pfm-surveys

# PostgreSQL (Docker)
POSTGRES_USER=surveys_user
POSTGRES_PASSWORD=change_this_password
POSTGRES_DB=surveys_dev

# Redis (Docker)
# REDIS_PASSWORD=
